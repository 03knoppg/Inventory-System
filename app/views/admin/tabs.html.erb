<a class="tab_title tab_title_expanded" href="#"><h1 class="title_header"><%=image_tag "Accordian/bigminus.gif"%>&nbspProduct: <%= @product.name %></h1></a>

<!--Page Container -->
<div class="inner_container">
  <div id="products_partial"><%= render "products/popup_show" %></div>
  <!-- Tabs for directly related objects to the Product -->
  <div class="tabs">
    <ul>
      <li><a class="l" href="">Components</a></li>
      <li><a class="l" href="">Value Fields</a></li>
      <li><a class="l" href="">Images</a></li>
      <li><a class="l" href="">Data Files</a></li>
    </ul>
    <div>
      <div>
        <%= render "admin/components_tabs", :parent => @product%>
      </div>
      <div>
        <!-- Tabs for directly related ValueFields to the Product -->
        <div class="tabs2">
          <ul>
            <li style="display:none"><a>hidden</a></li>
            <li><a class="new_vf" href>New Valuefield...</a></li>
            <% for valuefield in @product_valuefields %>
                <li><a href=""><%= valuefield.fieldvalue %></a></li>
            <% end %>
          </ul>
          <div>
            <div style="">   <div class="inner_container"><p style="text-align: center">Select a tab from the list to display details</p></div></div>
            <div><div class="inner_container vf_container"><%# render("valuefields/new") %></div></div>
            <% for valuefield in @product_valuefields %>
                <div><%= render("/valuefields/show", :valuefield => valuefield) %></div>
            <% end %>
          </div>
        </div>
      </div>
      <div>
        <!-- Tabs for directly related Images to the Product -->
        <div class="tabs2">
          <ul>
            <li style="display:none"><a>hidden</a></li>
            <li><a href class="new_image">New Image...</a></li>
            <% for image in @product_images %>
                <li><a href=""><%= image.picture_file_name %></a></li>
            <% end %>
          </ul>
          <div>
            <div style="">   <div class="inner_container"><p style="text-align: center">Select a tab from the list to display details</p></div></div>
            <div><div class="inner_container image_container"><%# render("images/new") %></div></div>
            <% for image in @product_images %>
                <div><%= render("/images/show", :image => image) %></div>
            <% end %>
          </div>
        </div>
      </div>
      <div>
        <!-- Tabs for directly related Data Files to the Product -->
        <div class="tabs2">
          <ul>
            <li style="display:none"><a>hidden</a></li>
            <li><a href class="new_df">New Data File...</a></li>
            <% for datafile in @product_datafiles %>
                <li><a href="" class="xl"><%= datafile.filedata_file_name %></a></li>
            <% end %>
          </ul>
          <div>
            <div style="">   <div class="inner_container"><p style="text-align: center">Select a tab from the list to display details</p></div></div>
            <div><div class="inner_container df_container"><%# render("data_files/new") %></div></div>
            <% for data_file in @product_datafiles %>
                <div><%= render("/data_files/show", :data_file => data_file) %></div>
            <% end %>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>


<script type="text/javascript">
    jQuery(function($) {

        $('a[value="Edit Product"]').click(function(){
            $.get("/admin/load_edit_product_page", {product_id: "<%=@product.id%>"},null, 'script');
        });

        $('.new_vf').live('click', function(){
            container = $(this).closest('div.tabs2').find('div.vf_container:first');
            container.addClass("new_vf_container");
            $.get("/admin/load_new_vf_page", null, 'script');
        });
        $('.new_image').live('click', function(){
            container = $(this).closest('div.tabs2').find('div.image_container:first');
            container.addClass("new_image_container");
            $.get("/admin/load_new_image_page", null, 'script');
        });

        $('.new_df').live('click', function(){
            container = $(this).closest('div.tabs2').find('div.df_container:first');
            container.addClass("new_df_container");
            $.get("/admin/load_new_df_page", null, 'script');
        });

        $('.new_component').live('click', function(){
            container = $(this).closest('div.tabs2').find('div.component_container:first');
            container.addClass("new_component_container");
            $.get("/admin/load_new_component_page", null, 'script');
        });


        $('.inner_container:first').css("overflow-x" ,"hidden");
        $('.inner_container:first').css("overflow-y", "scroll");


        $('div.tabs2 > ul > li > a').live('click',function () {

            if($(this).attr("href") != ""){
                $('#'+$(this).attr("href")).html("");
                $.get("/admin/load_component_tab", {item: $(this).attr("href")}, null, 'script');

            }

            return false;
        });


        $('a.tab_title').live('click',expandColapseSection);
        $('.inner_container').scroll(moveULs);
        $('.tabs > ul > li > a').live('click', function(){
            moveULs();
            $(document).find('div.inner_container').filter(function(){return $(this).width()>0;}).each(function(){
                adjustWidth($(this), false, false)
            });
            enableMinimizers();
        });


        setUpSliders();
        adjustWidth($('div.tabs2  div.inner_container'), true, false);
         adjustHeight();
        setUpPopUp();
        enableMinimizers();
    });

    //sets up the pop up overlay for each edit button
    function setUpPopUp(){
         // setup triggers
	$("a[rel]").each(function(i) {

		$(this).overlay({

			// common configuration for each overlay
			oneInstance: false,
			closeOnClick: true,

			// setup custom finish position
			//top: positions[i][0],
			//left: positions[i][1],

			// use apple effect
			mask: 'lightblue',
            effect: 'apple',

		onBeforeLoad: function() {

			// grab wrapper element inside content
			var wrap = this.getOverlay().find(".contentWrap");

			// load the page specified in the trigger
			wrap.load(this.getTrigger().attr("href"));
		}
		});
	});
    }

    function expandColapseSection(){

        if(!$(this).hasClass('enabled'))
            return;

        inner_container = $(this).siblings('.inner_container');

        //minimize
        if($(this).hasClass("tab_title_expanded")){
            $(this).removeClass("tab_title_expanded");
            $(this).addClass("tab_title_minimized");
            $(this).find('img').attr("src", "/assets/Accordian/plus.gif");
            $(this).find('h1').css({fontSize: "150%"});

            inner_container.css("overflow-x" ,"hidden");
            inner_container.css("overflow-y" ,"hidden");
            inner_container.find('div.inner_container:first').parent().parent().children('*').children('div.inner_container').each(function(){
                $(this).css("overflow-x" ,"hidden");
                $(this).css("overflow-y" ,"scroll");
            });


            inner_container.children('div:first').animate({height: 'toggle'});
            inner_container.find('> div.tabs > div').css("border", 0);
            inner_container.find('> div.tabs:first > ul').animate({height: 'toggle'});
            inner_container.find('> div.tabs:first > ul > li').animate({height: 'toggle'});

            //inner_container.find('div.tabs2:first > ul').animate({width: '0'});
            inner_container.find('> div.tabs > div > div > div.tabs2 > ul').css({width: '0'});

            //inner_container.find('div.tabs2:first > div').animate({width: '100%'});
            inner_container.find('> div.tabs > div > div > div.tabs2 > div').css({width: '100%'});

            inner_container.find('> div.tabs > div > div > div.tabs2 > div').css("border-top", 0);
            adjustHeight();
            inner_container.find('.inner_container').filter(function(){return $(this).width() > 0;}).each(function(){
                adjustWidth($(this), false, true);
            });
        }

        //expand
        else{

            $(this).removeClass("tab_title_minimized");
            $(this).addClass("tab_title_expanded");
            $(this).find('img').attr("src", "/assets/Accordian/bigminus.gif");
            $(this).find('h1').css({fontSize: "300%"});

            inner_container.css("overflow-x" ,"hidden");
            inner_container.css("overflow-y" ,"scroll");
            inner_container.find('div.inner_container:first').parent().parent().children('*').children('div.inner_container').each(function(){
                $(this).css("overflow-x" ,"hidden");
                $(this).css("overflow-y" ,"hidden");
            });
            inner_container.find('div.tabs:first > ul > li > a:first ').click();
            inner_container.children('div:first').animate({height: 'toggle'});
            inner_container.find('div.tabs:first > div').css("border", "1px solid #999");
            inner_container.find('div.tabs:first > div').css("border-top", 0);
            inner_container.find('> div.tabs:first > ul').animate({height: 'toggle'});
            inner_container.find('> div.tabs:first > ul > li').animate({height: 'toggle'});

            //inner_container.find('div.tabs2:first > ul').animate({width: 'toggle'});
            inner_container.find('> div.tabs > div > div > div.tabs2 > ul').css("width", '132');

            fullwidth = inner_container.find('div.tabs2:first').width();
            ulWidth = inner_container.find('div.tabs2:first > ul').width();
            inner_container.find('> div.tabs > div > div > div.tabs2 > div').css({width:fullwidth - 132});

            inner_container.find('div.tabs2:first > div').css("border-top", "1px solid #999");
            adjustHeight();
            $('.inner_container').filter(function(){return $(this).width() > 0;}).each(function(){
                adjustWidth($(this), false, false);
            });
        }

        enableMinimizers()


    }

    function setUpSliders(){
        //Expand/Collapse javascript
        $(".content").hide();
        $(".heading").unbind('click');
        //toggle the componenet with class msg_body
        $(".heading").bind("click", function() {
            $(this).next(".content").slideToggle(1200).scroll();
        });
    }

    function cleanUp(pane){

        pane.find('div.tabs, div.tabs2').each(function(){
           $(this).find('ul:first').tabs($(this).find('div:first > div'));
        });

        pane.find(".content").hide();                             //toggle the componenet with class msg_body
        pane.find(".heading").click(function() {
            $(this).next(".content").slideToggle(1200).scroll();
        });



        $("html").addClass("js");
        $.fn.accordion.defaults.container = false;
        pane.find(".accordion").accordion();
        $("html").removeClass("js");

        adjustWidth(pane.find('div.tabs2').find('.inner_container:first'), false, false);
        adjustHeight();

        enableMinimizers();


    }

    function enableMinimizers(){

        minimized_sections = $('h1').filter(function(){return $(this).height() > 0 && $(this).parent().hasClass('tab_title_minimized');});
        expanded_sections = $('h1').filter(function(){return $(this).height() > 0 && $(this).parent().hasClass('tab_title_expanded');});


        minimized_sections.each(function(){
            $(this).parent().removeClass('enabled');
            $(this).find('img').attr("src", "/assets/Accordian/plusdisabled.gif");
        });

        expanded_sections.each(function(){
            $(this).parent().removeClass('enabled');
            $(this).find('img').attr("src", "/assets/Accordian/bigminusdisabled.gif");
        });


        minimized_sections.last().each(function(){
            $(this).parent().addClass('enabled');
            $(this).find('img').attr("src", "/assets/Accordian/plus.gif");
        });


        if($('h1').filter(function(){return $(this).height() > 0}).length > 1){
            expanded_sections.first().each(function(){
                $(this).parent().addClass('enabled');
                $(this).find('img').attr("src", "/assets/Accordian/bigminus.gif");
            });
        }

    }

    function adjustHeight(){
       $('.inner_container').each(function(){
           if($(this).css("overflow-y") == "scroll"){
               $(this).css("height", "630");
           }
            else {
               $(this).css("height","100%");
           }
        });
        $('.container').css({height:862});
    }

    function adjustWidth(pane, first, minimizing) {

        tabs = pane.closest('div.tabs2');
        if(tabs == null)
            return;

        tabwidth = Number(tabs.width());
        ulWidth = Number(tabs.children('ul').width());
        if(ulWidth == null)
            ulWidth = 0;

        //ulWidth = 0;
        if(first)
            tabs.find(' > div').width(tabwidth - ulWidth - 15);
        else if(minimizing){
            tabs.find(' > div').width(tabwidth - 134);
            tabs.find(' > div').animate({width: tabwidth});
        }
        else
            tabs.find(' > div').width(tabwidth - ulWidth);

    }



    function moveULs(){

        $(document).find('div.tabs2 > ul').filter(function(){return $(this).height()>0;}).each(function(){

            offset = $(document).find('.inner_container:first').offset().top + 3;
            minimized_count = $(document).find('a.tab_title_expanded:first').parents('.inner_container').length;
            offset += 57 * minimized_count;

            if($(this).height() < $(document).find('a.tab_title_expanded:first').siblings('.inner_container').height() &&  $(this).parent().position().top < offset){
               $(this).css("top", offset);
               $(this).css("position", "fixed");

            } else {
               $(this).css("top", 0);
               $(this).css("position", "");
            }
        });




    }
</script>



