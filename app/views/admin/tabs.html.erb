<a class="tab_title tab_title_expanded" href="#"><h1 class="title_header"><%=image_tag "Accordian/bigminus.gif"%>&nbspProduct: <%= @product.name %></h1></a>

<!--Page Container -->
<div class="inner_container">
  <div id="products_partial"><%= render "products/popup_show" %></div>
  <!-- Tabs for directly related objects to the Product -->
  <div class="tabs">
    <ul>
      <li><a class="l" href="">Components</a></li>
      <li><a class="l" href="">Value Fields</a></li>
      <li><a class="l" href="">Images</a></li>
      <li><a class="l" href="">Data Files</a></li>
    </ul>
    <div>
      <div>
        <%= render "admin/components_tabs", :parent => @product%>
      </div>
      <div>
        <!-- Tabs for directly related ValueFields to the Product -->
        <div class="tabs2">
          <ul>
            <li style="display:none"><a>hidden</a></li>
            <li><a href>New Valuefield...</a></li>
            <% for valuefield in @product_valuefields %>
                <li><a href=""><%= valuefield.fieldvalue %></a></li>
            <% end %>
          </ul>
          <div>
            <div style="">   <div class="inner_container"><p style="text-align: center">Select a tab from the list to display details</p></div></div>
            <div><div class="inner_container"><%= render("valuefields/new") %></div></div>
            <% for valuefield in @product_valuefields %>
                <div><%= render("/valuefields/show", :valuefield => valuefield) %></div>
            <% end %>
          </div>
        </div>
      </div>
      <div>
        <!-- Tabs for directly related Images to the Product -->
        <div class="tabs2">
          <ul>
            <li style="display:none"><a>hidden</a></li>
            <li><a href>New Image...</a></li>
            <% for image in @product_images %>
                <li><a href=""><%= image.picture_file_name %></a></li>
            <% end %>
          </ul>
          <div>
            <div style="">   <div class="inner_container"><p style="text-align: center">Select a tab from the list to display details</p></div></div>
            <div><div class="inner_container"><%= render("images/new") %></div></div>
            <% for image in @product_images %>
                <div><%= render("/images/show", :image => image) %></div>
            <% end %>
          </div>
        </div>
      </div>
      <div>
        <!-- Tabs for directly related Data Files to the Product -->
        <div class="tabs2">
          <ul>
            <li style="display:none"><a>hidden</a></li>
            <li><a href>New Data File...</a></li>
            <% for datafile in @product_datafiles %>
                <li><a href="" class="xl"><%= datafile.filedata_file_name %></a></li>
            <% end %>
          </ul>
          <div>
            <div style="">   <div class="inner_container"><p style="text-align: center">Select a tab from the list to display details</p></div></div>
            <div><div class="inner_container"><%= render("data_files/new") %></div></div>
            <% for data_file in @product_datafiles %>
                <div><%= render("/data_files/show", :data_file => data_file) %></div>
            <% end %>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>


<script type="text/javascript">
    jQuery(function($) {

        $('a.tab_title').live('click',expandColapseSection);

        $('.inner_container:first').css("overflow-x" ,"hidden");
        $('.inner_container:first').css("overflow-y", "scroll");


        $('div.tabs2 > ul > li > a').live('click',function () {

            if($(this).attr("href") != ""){
                $('#'+$(this).attr("href")).html("");
                $.get("/admin/load_component_tab", {item: $(this).attr("href")}, null, 'script');

            }

            return false;
        });


        $('.inner_container').scroll(moveULs);
        $('.tabs > ul > li > a').live('click', moveULs);
        $('.tabs > ul > li > a').live('click', function(){
            $(document).find('div.inner_container').filter(function(){return $(this).width()>0;}).each(function(){
                adjustWidth($(this), false, false)
            });
        });
        setUpSliders();
        adjustWidth($('div.tabs2  div.inner_container'), true, false);
        adjustHeight();


    });

    function expandColapseSection(){
        inner_container = $(this).siblings('.inner_container');

        //minimize
        if($(this).hasClass("tab_title_expanded")){
            $(this).removeClass("tab_title_expanded");
            $(this).addClass("tab_title_minimized");
            $(this).find('img').attr("src", "/assets/Accordian/plus.gif");
            $(this).find('h1').css({fontSize: "150%"});

            inner_container.css("overflow-x" ,"hidden");
            inner_container.css("overflow-y" ,"hidden");
            inner_container.find('div.inner_container:first').parent().parent().children('*').children('div.inner_container').each(function(){
                $(this).css("overflow-x" ,"hidden");
                $(this).css("overflow-y" ,"scroll");
            });


            inner_container.children('div:first').animate({height: 'toggle'});
            inner_container.find('div.tabs:first > div').css("border", 0);
            inner_container.find('div.tabs:first > ul').animate({height: 'toggle'});
            inner_container.find('div.tabs:first > ul > li').animate({height: 'toggle'});

            //inner_container.find('div.tabs2:first > ul').animate({width: '0'});
            inner_container.find('div.tabs2:first > ul').css({width: '0'});

            //inner_container.find('div.tabs2:first > div').animate({width: '100%'});
            inner_container.find('div.tabs2:first > div').css({width: '100%'});

            inner_container.find('div.tabs2:first > div').css("border-top", 0);
            adjustHeight();
            inner_container.find('.inner_container').filter(function(){return $(this).width() > 0;}).each(function(){
                adjustWidth($(this), false, true);
            });
        }

        //expand
        else{

            $(this).removeClass("tab_title_minimized");
            $(this).addClass("tab_title_expanded");
            $(this).find('img').attr("src", "/assets/Accordian/bigminus.gif");
            $(this).find('h1').css({fontSize: "300%"});

            inner_container.css("overflow-x" ,"hidden");
            inner_container.css("overflow-y" ,"scroll");
            inner_container.find('div.inner_container:first').parent().parent().children('*').children('div.inner_container').each(function(){
                $(this).css("overflow-x" ,"hidden");
                $(this).css("overflow-y" ,"hidden");
            });

            inner_container.children('div:first').animate({height: 'toggle'});
            inner_container.find('div.tabs:first > div').css("border", "1px solid #999");
            inner_container.find('div.tabs:first > div').css("border-top", 0);
            inner_container.find('div.tabs:first > ul').animate({height: 'toggle'});
            inner_container.find('div.tabs:first > ul > li').animate({height: 'toggle'});

            //inner_container.find('div.tabs2:first > ul').animate({width: 'toggle'});
            inner_container.find('div.tabs2:first > ul').css("width", '132');

            fullwidth = inner_container.find('div.tabs2:first').width();
            ulWidth = inner_container.find('div.tabs2:first > ul').width();
            inner_container.find('div.tabs2:first > div').css({width:fullwidth - 132});

            inner_container.find('div.tabs2:first > div').css("border-top", "1px solid #999");
            adjustHeight();
            $('.inner_container').filter(function(){return $(this).width() > 0;}).each(function(){
                adjustWidth($(this), false, false);
            });
        }


    }

    function setUpSliders(){
        //Expand/Collapse javascript
        $(".content").hide();
        $(".heading").unbind('click');
        //toggle the componenet with class msg_body
        $(".heading").bind("click", function() {
            $(this).next(".content").slideToggle(1200).scroll();
        });
    }

    function cleanUp(pane){

        pane.find('div.tabs, div.tabs2').each(function(){
           $(this).find('ul:first').tabs($(this).find('div:first > div'));
        });

        pane.find(".content").hide();                             //toggle the componenet with class msg_body
        pane.find(".heading").click(function() {
            $(this).next(".content").slideToggle(1200).scroll();
        });



        $("html").addClass("js");
        $.fn.accordion.defaults.container = false;
        pane.find(".accordion").accordion();
        $("html").removeClass("js");

        adjustWidth(pane.find('div.tabs2').find('.inner_container:first'), false, false);
        adjustHeight();


    }

    function adjustHeight(){
       $('.inner_container').each(function(){
           if($(this).css("overflow-y") == "scroll"){
               $(this).css("height", "630");
           }
            else {
               $(this).css("height","100%");
           }
        });
        $('.container').css({height:862});
    }

    function adjustWidth(pane, first, minimizing) {

        tabs = pane.closest('div.tabs2');
        if(tabs == null)
            return;

        tabwidth = Number(tabs.width());
        ulWidth = Number(tabs.children('ul').width());
        if(ulWidth == null)
            ulWidth = 0;

        //ulWidth = 0;
        if(first)
            tabs.find(' > div').width(tabwidth - ulWidth - 15);
        else if(minimizing){
            tabs.find(' > div').width(tabwidth - 134);
            tabs.find(' > div').animate({width: tabwidth});
        }
        else
            tabs.find(' > div').width(tabwidth - ulWidth);

    }



    function moveULs(){

        $(document).find('div.tabs2 > ul').filter(function(){return $(this).height()>0;}).each(function(){

            offset = $(document).find('.inner_container:first').offset().top + 3;
            offset += 57 * $(document).find('a.tab_title_expanded:first').parents('.inner_container').length;

            if( $(this).parent().position().top < offset){
               $(this).css("top", offset);
               $(this).css("position", "fixed");

            } else {
               $(this).css("top", 0);
               $(this).css("position", "");
            }
        });




    }
</script>



